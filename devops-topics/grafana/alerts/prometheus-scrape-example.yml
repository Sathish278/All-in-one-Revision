# Example Prometheus scrape_config for Grafana
# Use in prometheus.yml or create a ServiceMonitor for Prometheus Operator

scrape_configs:
  - job_name: 'grafana'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_label_app]
        regex: grafana
        action: keep
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_port, __address__]
        regex: ([0-9]+);(.+)
        replacement: $2:$1
        target_label: __address__
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scheme]
        regex: https
        replacement: https
        target_label: __scheme__

    metric_relabel_configs:
      - source_labels: [__meta_kubernetes_pod_name]
        action: drop

# Notes: If you use the Prometheus Operator, create a ServiceMonitor that matches the Grafana service instead.
