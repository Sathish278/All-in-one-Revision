# Example Prometheus scrape_config for scraping Prometheus server itself or node-exporter
# Use in prometheus.yml or adapt to ServiceMonitor for the Prometheus Operator

scrape_configs:
  - job_name: 'prometheus'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_label_app]
        regex: prometheus
        action: keep
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_port, __address__]
        regex: ([0-9]+);(.+)
        replacement: $2:$1
        target_label: __address__

  - job_name: 'node-exporter'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_label_app]
        regex: node-exporter
        action: keep
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_port, __address__]
        regex: ([0-9]+);(.+)
        replacement: $2:$1
        target_label: __address__

# Notes: For managed Prometheus (Thanos/Cortex) or kube-prometheus-stack, prefer ServiceMonitor/PodMonitor CRs.
